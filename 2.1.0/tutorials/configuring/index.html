
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Tutorial: Configuring Your Application - Convoke</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-configuring-your-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Convoke" class="md-header__button md-logo" aria-label="Convoke" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Convoke
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial: Configuring Your Application
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/eykd/convoke" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eykd/convoke
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Convoke" class="md-nav__button md-logo" aria-label="Convoke" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Convoke
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eykd/convoke" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eykd/convoke
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convoke
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/bases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    convoke.bases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/configs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    convoke.configs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mountpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    convoke.mountpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/signals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    convoke.signals
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial: Configuring Your Application
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial: Configuring Your Application
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#built-in-configuration-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in configuration settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-configuration-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Custom configuration settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Protecting secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-configuration-field-types" class="md-nav__link">
    <span class="md-ellipsis">
      Other configuration field types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other configuration field types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-fields-with-multiple-values" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration fields with multiple values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefer-immutability" class="md-nav__link">
    <span class="md-ellipsis">
      Prefer immutability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-a-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      Generating a .env file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documenting-configuration-values" class="md-nav__link">
    <span class="md-ellipsis">
      Documenting configuration values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#built-in-configuration-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in configuration settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-configuration-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Custom configuration settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Protecting secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-configuration-field-types" class="md-nav__link">
    <span class="md-ellipsis">
      Other configuration field types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other configuration field types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-fields-with-multiple-values" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration fields with multiple values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefer-immutability" class="md-nav__link">
    <span class="md-ellipsis">
      Prefer immutability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-a-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      Generating a .env file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documenting-configuration-values" class="md-nav__link">
    <span class="md-ellipsis">
      Documenting configuration values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tutorial-configuring-your-application">Tutorial: Configuring Your Application</h1>
<p>In this tutorial, we'll see how to use <code>convoke</code> to configure a simple Starlette
web application.</p>
<p>We'll start with a very simple Starlette web app:</p>
<pre><code class="language-python"># app.py
from starlette.applications import Starlette
from starlette.responses import JSONResponse
from starlette.routing import Route

templates = Jinja2Templates(directory='templates')


async def homepage(request):
    return templates.TemplateResponse(
        &quot;index.html&quot;,
        {&quot;request&quot;: request, &quot;DEBUG&quot;: request.app.debug}
    )


def create_app():
    return Starlette(debug=True, routes=[
        Route('/', homepage),
    ])
</code></pre>
<h2 id="built-in-configuration-settings">Built-in configuration settings</h2>
<p>Now, of course, we don't want to always be in debug mode. Let's add a
configuration by subclassing <code>convoke.configs.BaseConfig</code>:</p>
<pre><code class="language-python"># app.py
from starlette.applications import Starlette
from starlette.responses import JSONResponse
from starlette.routing import Route

from convoke.configs import BaseConfig, env_field

# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;


def create_app():
    config = WebAppConfig()

    return Starlette(debug=config.DEBUG, routes=[
        Route('/', homepage),
    ])

</code></pre>
<p>Every instance of <code>BaseConfig</code> has two built-in settings: <code>DEBUG</code> and <code>TESTING</code>,
both booleans with a default value of <code>False</code>. So, if we run our application, it
will default to production mode:</p>
<pre><code class="language-shell">$ uvicorn --factory app.create_app
</code></pre>
<p>But if we set the environment variable <code>DEBUG=True</code>, it will run in development
mode:</p>
<pre><code class="language-shell">$ DEBUG=True uvicorn --factory app.create_app
</code></pre>
<p><code>DEBUG=true</code> and <code>DEBUG=TRUE</code> would also work, but <code>tRuE</code> would not. Likewise,
with equivalent cases of <code>DEBUG=False</code>.</p>
<h2 id="custom-configuration-settings">Custom configuration settings</h2>
<p>Now, to improve our application, we'll want our users to be able to login, and
for that, we'll need sessions:</p>
<pre><code class="language-python"># app.py
from starlette.applications import Starlette
from starlette.middleware import Middleware
from starlette.middleware.sessions import SessionMiddleware
# ...

def create_app():
    config = WebAppConfig()

    return Starlette(
        debug=config.DEBUG,
        routes=[
            Route('/', homepage),
        ],
        middleware=[
            Middleware(
                SessionMiddleware,
                secret_key=&quot;supers3kr1t&quot;,
                https_only=not config.DEBUG)
        ],
    )
</code></pre>
<p>We see how the configuration is already making our lives easier: in production
we want secure sessions, which requires HTTPS, but in development we don't want
to bother with HTTPS, so we use <code>https_only=not config.DEBUG</code> to only require
HTTPS in production.</p>
<h2 id="protecting-secrets">Protecting secrets</h2>
<p>However, we have another problem: our secret key is stored in plain text in our
Python source. Anyone who can read this file can discover our secret and hack
our users! What to do?</p>
<p>Let's move our secret key to the environment:</p>
<pre><code class="language-python"># app.py
# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;

    SECRET_KEY: str = env_field()


def create_app():
    config = WebAppConfig()

    return Starlette(
        # ...
        middleware=[
            Middleware(
                SessionMiddleware,
                secret_key=config.SECRET_KEY,
                https_only=not config.DEBUG)
        ],
    )

</code></pre>
<p>We use all caps <code>SECRET_KEY</code> by convention, and the corresponding environment
variable:</p>
<pre><code class="language-shell">$ DEBUG=True SECRET_KEY=&quot;supers3kr1t&quot;  uvicorn --factory app.create_app
</code></pre>
<p>Now, one problem is that if we ever print our configuration to the console, we
get our secret in plain text again:</p>
<pre><code class="language-python">$ DEBUG=True SECRET_KEY=&quot;supers3kr1t&quot;  python
&gt;&gt;&gt; from app import WebAppConfig

&gt;&gt;&gt; print(WebAppConfig())
WebAppConfig(DEBUG=True, TESTING=False, SECRET_KEY='supers3kr1t')
</code></pre>
<p>Let's fix that by using the <code>Secret</code> type:</p>
<pre><code class="language-python"># app.py
# ...
from convoke.configs import BaseConfig, env_field, Secret
# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;

    SECRET_KEY: Secret = env_field()

</code></pre>
<p>Now, when we print to the console, our secret is safe:</p>
<pre><code class="language-python">$ DEBUG=True SECRET_KEY=&quot;supers3kr1t&quot;  python
&gt;&gt;&gt; from app import WebAppConfig

&gt;&gt;&gt; print(WebAppConfig())
WebAppConfig(DEBUG=True, TESTING=False, SECRET_KEY=Secret('**********'))
</code></pre>
<p>But when we use the secret as a string, we get the plain-text value:</p>
<pre><code class="language-python">&gt;&gt;&gt; str(WebAppConfig().SECRET_KEY)
'supers3kr1t'
</code></pre>
<h2 id="other-configuration-field-types">Other configuration field types</h2>
<p>Since we're considering security, let's consider our session age. Starlette's
default session age is 2 weeks (1,209,600 seconds), but say that for our
application, we require that a user session must be refreshed by authentication
every 24 hours (86,400 seconds). As a business policy, this may change in the
future, so let's make it a configurable value:</p>
<pre><code class="language-python"># app.py
# ...
from convoke.configs import BaseConfig, env_field, Secret
# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;

    SECRET_KEY: Secret = env_field()
    SESSION_COOKIE_MAX_AGE: int = env_field(default=86_400)


def create_app():
    config = WebAppConfig()

    return Starlette(
        # ...
        middleware=[
            Middleware(
                SessionMiddleware,
                secret_key=config.SECRET_KEY,
                https_only=not config.DEBUG,
                max_age=config.SESSION_COOKIE_MAX_AGE,
            ),
        ],
    )

</code></pre>
<p>By annotating the type of the configuration field, we tell <code>convoke</code> how to
parse the environment string. This works for floats and booleans too:</p>
<pre><code class="language-python">class MyConfig(BaseConfig):
    VALUE_OF_PI: float = env_field(default=3.14)
    USE_ANTIGRAVITY: bool = env_field(default=False)
</code></pre>
<h3 id="configuration-fields-with-multiple-values">Configuration fields with multiple values</h3>
<p>Now, to really make sure our application is secure, let's configure Starlette's
<code>TrustedHostMiddleware</code>:</p>
<pre><code class="language-python"># app.py
# ...
from starlette.middleware.trustedhost import TrustedHostMiddleware
# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;

    SECRET_KEY: Secret = env_field()
    SESSION_COOKIE_MAX_AGE: int = env_field(default=86_400)
    ALLOWED_HOSTS: tuple[str] = env_field(default=('127.0.0.1', 'localhost'))


def create_app():
    config = WebAppConfig()

    return Starlette(
        # ...
        middleware=[
            # ...
            Middleware(
                TrustedHostMiddleware,
                allowed_hosts=config.ALLOWED_HOSTS,
            ),
        ],
    )
</code></pre>
<p>By using the type annotation <code>tuple[str]</code>, we tell <code>convoke</code> to parse the value
as a comma-separated list of strings, resulting in a tuple of strings:</p>
<pre><code class="language-shell">$ DEBUG=True SECRET_KEY=&quot;supers3kr1t&quot; ALLOWED_HOSTS=&quot;example.com,*.example.com&quot;  uvicorn --factory app.create_app
</code></pre>
<p>We could also use <code>tuple[int]</code> for a setting that uses a sequence of integers, etc.</p>
<h3 id="prefer-immutability">Prefer immutability</h3>
<p>For that matter, we could also use <code>ALLOWED_HOSTS: list[str]</code> give us a list of
strings instead of a tuple, but Config instances are immutable, and it's best to
use immutable types for configuration values as well.</p>
<h2 id="generating-a-env-file">Generating a .env file</h2>
<p>As we've added more configuration values, our <code>uvicorn</code> invocation has been
getting longer and longer. Web applications can have tens if not hundreds of
configuration values, and we don't want to type these out every time we start up
the dev server! Let's fix that:</p>
<pre><code class="language-python"># app.py
# ...
from convoke.configs import BaseConfig, env_field, generate_dot_env, Secret
# ...

if __name__ == &quot;__main__&quot;:
    print(generate_dot_env(BaseConfig.gather_settings()))
</code></pre>
<p>Then, in the shell:</p>
<pre><code>$ python app.py &gt; .env
$ cat .env
################################
## convoke.configs.BaseConfig ##
################################
##
## Base settings common to all configurations

# ------------------
# -- DEBUG (bool) --
# ------------------
#
# Development mode?

DEBUG=&quot;False&quot;

# --------------------
# -- TESTING (bool) --
# --------------------
#
# Testing mode?

TESTING=&quot;False&quot;


###########################
## __main__.WebAppConfig ##
###########################
##
## Configuration for our web application.

# ---------------------------------------
# -- SECRET_KEY (Secret) **Required!** --
# ---------------------------------------

SECRET_KEY=&quot;6BIW_mb496YHiptQ1E4WVm-7b_YBW1zQFqZnBKmcsDpTlb1Qb8uZ8w&quot;

# ---------------------------
# -- SESSION_COOKIE_MAX_AGE (int) --
# ---------------------------

SESSION_COOKIE_MAX_AGE=&quot;86400&quot;

# ---------------------------
# -- ALLOWED_HOSTS (tuple) --
# ---------------------------

ALLOWED_HOSTS=&quot;127.0.0.1,localhost&quot;
</code></pre>
<p>A few things to note here:</p>
<ul>
<li>Default values are included</li>
<li>Secrets are assigned a securely-generated value</li>
<li>Configuration values have documentation!</li>
</ul>
<h2 id="documenting-configuration-values">Documenting configuration values</h2>
<p>Let's add some documentation to our config values:</p>
<pre><code class="language-python"># app.py
# ...

class WebAppConfig(BaseConfig):
    &quot;&quot;&quot;Configuration for our web application.&quot;&quot;&quot;

    SECRET_KEY: Secret = env_field(
        doc=&quot;&quot;&quot;
            Secret used to cryptographically sign session cookies.

            This should be set to a unique, unpredictable value and kept safe
            from prying eyes.
        &quot;&quot;&quot;,
    )
    SESSION_COOKIE_MAX_AGE: int = env_field(
        default=86_400,
        doc=&quot;&quot;&quot;
            The maximum age of session cookies, in seconds.

            Defaults to 24 hours.
        &quot;&quot;&quot;,
    )
    ALLOWED_HOSTS: tuple[str] = env_field(
        default=('127.0.0.1', 'localhost'),
        doc=&quot;&quot;&quot;
            A list of strings representing the host/domain names that this site can serve.
        &quot;&quot;&quot;
    )
</code></pre>
<p>And now, if we generate a <code>.env</code> file again, we see our new documentation:</p>
<pre><code>$ python app.py
# ...
###########################
## __main__.WebAppConfig ##
###########################
##
## Configuration for our web application.

# ---------------------------------------
# -- SECRET_KEY (Secret) **Required!** --
# ---------------------------------------
#
# Secret used to cryptographically sign session cookies.
#
# This should be set to a unique, unpredictable value and kept safe from
# prying eyes.

SECRET_KEY=&quot;6rlnXtlxeggkgaG1Y4EsEitfRTGjUxu8zbdtZ8GpwfbwCmi0J2Tb3w&quot;

# ----------------------------------
# -- SESSION_COOKIE_MAX_AGE (int) --
# ----------------------------------
#
# The maximum age of session cookies, in seconds.
#
# Defaults to 24 hours.

SESSION_COOKIE_MAX_AGE=&quot;86400&quot;

# ---------------------------
# -- ALLOWED_HOSTS (tuple) --
# ---------------------------
#
# A list of strings representing the host/domain names that this site can serve.

ALLOWED_HOSTS=&quot;127.0.0.1,localhost&quot;
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>With that, you should now understand the basics of configuring a Starlette
application with <code>convoke</code>, including how to keep secrets safe, and how to
document your settings.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
    
  </body>
</html>